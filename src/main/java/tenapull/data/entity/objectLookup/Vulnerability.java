package tenapull.data.entity.objectLookup;

import com.fasterxml.jackson.annotation.*;
import tenapull.data.entity.lookup.*;
import tenapull.data.entity.template.*;
import tenapull.data.persistence.*;
import tenapull.util.*;

import javax.persistence.*;
import java.util.*;

/**
 * Represents a reusable "object lookup", for the objects in the "vulnerabilities" array
 * returned from the Nessus API at both /scans/&lt;scan-id&gt; AND /scans/&lt;scan-id&gt;/hosts/&lt;host-d&gt;
 */
@Entity(name = "Vulnerability")
@Table(name = "vulnerability")
@JsonIgnoreProperties({"id", "host_id"})
public class Vulnerability extends GeneratedIdPojo implements MapLookupPojo<Vulnerability> {

    /**
     * The dao for Vulnerability
     */
    public static final MapLookupDao<Vulnerability> dao
            = new MapLookupDao<Vulnerability>(Vulnerability.class);

    private Integer count;

    @ManyToOne(cascade = {CascadeType.PERSIST, CascadeType.MERGE, CascadeType.REFRESH, CascadeType.DETACH})
    @JoinColumn(name = "score_id")
    private VulnerabilityScore score;

    @Column(name = "vuln_index")
    @JsonProperty("vuln_index")
    private Integer vulnIndex;

    @ManyToOne(cascade = {CascadeType.PERSIST, CascadeType.MERGE, CascadeType.REFRESH, CascadeType.DETACH})
    @JoinColumn(name = "plugin_name_id")
    @JsonProperty("plugin_name")
    private PluginName pluginName;

    private Integer severity;

    @Column(name = "plugin_id")
    @JsonProperty("plugin_id")
    private Integer pluginId; // foreign key for plugin ???????

    @Column(name = "severity_index")
    @JsonProperty("severity_index")
    private Integer severityIndex;

    @ManyToOne(cascade = {CascadeType.PERSIST, CascadeType.MERGE, CascadeType.REFRESH, CascadeType.DETACH})
    @JoinColumn(name = "cpe_id")
    @JsonProperty("cpe")
    private Cpe cpe;

    private Boolean offline;

    @ManyToOne(cascade = {CascadeType.PERSIST, CascadeType.MERGE, CascadeType.REFRESH, CascadeType.DETACH})
    @JoinColumn(name="plugin_family_id")
    @JsonProperty("plugin_family")
    private PluginFamily pluginFamily;

    private Integer snoozed;

    @Transient
    @JsonIgnore
    @Override
    public void _prepare() {
        this.__prepare();
    }

    /**
     * Gets count.
     *
     * @return the count
     */
    public Integer getCount() {
        return count;
    }

    /**
     * Sets count.
     *
     * @param count the count
     */
    public void setCount(Integer count) {
        this.count = count;
    }

    /**
     * Gets cpe.
     *
     * @return the cpe
     */
    public Cpe getCpe() {
        return cpe;
    }

    /**
     * Sets cpe.
     *
     * @param cpe the cpe
     */
    public void setCpe(Cpe cpe) {
        this.cpe = cpe;
    }

    /**
     * Gets offline.
     *
     * @return the offline
     */
    public Boolean getOffline() {
        return offline;
    }

    /**
     * Sets offline.
     *
     * @param offline the offline
     */
    public void setOffline(Boolean offline) {
        this.offline = offline;
    }

    /**
     * Gets plugin family.
     *
     * @return the plugin family
     */
    public PluginFamily getPluginFamily() {
        return pluginFamily;
    }

    /**
     * Sets plugin family.
     *
     * @param pluginFamily the plugin family
     */
    public void setPluginFamily(PluginFamily pluginFamily) {
        this.pluginFamily = pluginFamily;
    }

    /**
     * Gets plugin id.
     *
     * @return the plugin id
     */
    public Integer getPluginId() {
        return pluginId;
    }

    /**
     * Sets plugin id.
     *
     * @param pluginId the plugin id
     */
    public void setPluginId(Integer pluginId) {
        this.pluginId = pluginId;
    }

    /**
     * Gets plugin name.
     *
     * @return the plugin name
     */
    public PluginName getPluginName() {
        return pluginName;
    }

    /**
     * Sets plugin name.
     *
     * @param pluginName the plugin name
     */
    public void setPluginName(PluginName pluginName) {
        this.pluginName = pluginName;
    }

    /**
     * Gets score.
     *
     * @return the score
     */
    public VulnerabilityScore getScore() {
        return score;
    }

    /**
     * Sets score.
     *
     * @param score the score
     */
    public void setScore(VulnerabilityScore score) {
        this.score = score;
    }

    /**
     * Gets severity.
     *
     * @return the severity
     */
    public Integer getSeverity() {
        return severity;
    }

    /**
     * Sets severity.
     *
     * @param severity the severity
     */
    public void setSeverity(Integer severity) {
        this.severity = severity;
    }

    /**
     * Gets severity index.
     *
     * @return the severity index
     */
    public Integer getSeverityIndex() {
        return severityIndex;
    }

    /**
     * Sets severity index.
     *
     * @param severityIndex the severity index
     */
    public void setSeverityIndex(Integer severityIndex) {
        this.severityIndex = severityIndex;
    }

    /**
     * Gets snoozed.
     *
     * @return the snoozed
     */
    public Integer getSnoozed() {
        return snoozed;
    }

    /**
     * Sets snoozed.
     *
     * @param snoozed the snoozed
     */
    public void setSnoozed(Integer snoozed) {
        this.snoozed = snoozed;
    }

    /**
     * Gets vuln index.
     *
     * @return the vuln index
     */
    public Integer getVulnIndex() {
        return vulnIndex;
    }

    /**
     * Sets vuln index.
     *
     * @param vulnIndex the vuln index
     */
    public void setVulnIndex(Integer vulnIndex) {
        this.vulnIndex = vulnIndex;
    }

    @Override
    public void _set(Vulnerability o) {
        this.__set(o);
        this.count = o.count;
        this.score = o.score;
        this.vulnIndex = o.vulnIndex;
        this.pluginName = o.pluginName;
        this.severity = o.severity;
        this.pluginId = o.pluginId;
        this.severityIndex = o.severityIndex;
        this.cpe = o.cpe;
        this.offline = o.offline;
        this.pluginFamily = o.pluginFamily;
        this.snoozed = o.snoozed;
    }

    @Override
    public boolean _match(Vulnerability o) {
        if (o == this) return true;
        return o != null
                && Objects.equals(this.count, o.count)
                && Objects.equals(this.score, o.score)
                && Objects.equals(this.vulnIndex, o.vulnIndex)
                && Objects.equals(this.pluginName, o.pluginName)
                && Objects.equals(this.severity, o.severity)
                && Objects.equals(this.pluginId, o.pluginId)
                && Objects.equals(this.severityIndex, o.severityIndex)
                && Objects.equals(this.cpe, o.cpe)
                && Objects.equals(this.offline, o.offline)
                && Objects.equals(this.pluginFamily, o.pluginFamily)
                && Objects.equals(this.snoozed, o.snoozed)
                && Objects.equals(this.getExtraJson(), o.getExtraJson());
    }

    public boolean equals(Object o) {
        if (o == null) return false;
        if (o == this) return true;

        if (!Objects.equals(this.getClass(), o.getClass())) {
            return false;
        }

        Vulnerability other = (Vulnerability) o;

        if (other.getId() != this.getId()) return false;
        return this._match(other);
    }

    @Transient
    @JsonIgnore
    @Override
    public Map<String, Object> _getSearchMap() {
        return MakeMap.of(new Object[] {
                "count", this.count,
                "score", this.score,
                "vulnIndex", this.vulnIndex,
                "pluginName", this.pluginName,
                "severity", this.severity,
                "pluginId", this.pluginId,
                "severityIndex", this.severityIndex,
                "cpe", this.cpe,
                "offline", this.offline,
                "pluginFamily", this.pluginFamily,
                "snoozed", this.snoozed,
                "extraJson", this.getExtraJson()
            });
    }

}
